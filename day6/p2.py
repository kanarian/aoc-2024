inp_test="""....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#..."""

inp_real=""".......#.........#..............#........................#......#....#............................#..#...............#............
...................#.............................................#...................................#............................
...............#.................................##.........#..........#.....##...#...#.....#....#..................#.............
#.............................................#..#.............#..........#.##.............................................#......
#.........................................................#.....#........................................##.......................
...........#.......#.#...........#....#.#...#......................................#...........................#...##............#
........................................................#..#.....................................#..#................#....#...#...
#.#.....#.........................#...........#.......................................#.......#.....................##............
.......#..........##.....#........#..................................................#.........................................#.#
#.#..............#.#.............................#............#....#...............#.........................#............#..#.#.#
..........................................................#....................................................#..................
.......................#....#...........#.....................#....#...#.......#..............#.......................#...........
..............................#..............#.......#....................................#.....................#...#...#.........
........#.................#...#....##..............#...........................#............................#.................#...
..................#........................................#......#......................................................#........
.............#.................#...#..............................................................................#...#...........
.....................................#..........................................................#.#.#......#.........#............
..........#...................................................................#.........##.......#..#.............................
...#.#....................................#..#...........#.......................................................##...............
........................................................................................................#.........................
.........#...........#......#..............#........#....................#...#......#.............................................
........#....#...............#....................#..........#.....................................#......#......#........#.#.....
........................#..........................#.......#........................#................#......#.....................
......................................#.........................................#............................#....................
...................................#.#...#...........#.........................................#.....................#............
.................#....#.....................................................................#..................#.........#........
...........#...........................................................#.............................#...............#..#.........
..#.....................#.........................................................................................................
....................#....#.#...........................#...........................................#..............#...............
...#...................................................#.............................................#.........#..........#.......
.............................###.....#..#..#......................................................................................
##................#.#.......#..............#.....#...............#..#............#................................................
......#...............................................#.#..#............................#............#.................#..........
........................................#.#...................................................#.....#.............................
#.......#.#.......................#.....#....................................#...................#................................
...##................................................................................................#.....................#......
............#.............#..................#.................#..................................................................
...#..............#..............................................................................#..........#......#..............
...#..#...#................................................#.....................#......#......................#.......#..........
.................#..#........#...............#.#................#......##.................#.................................#.....
#.....#.......#...........................................#..........#..............................#...#.#..#......#.....#.......
....................................#.........#........#..................#.............................................#.........
#...............................#........................#.................................................#.....#................
..#..................................#.......#.....................#..............................................................
........#...#.....................................#......#..............#..#..#..........................#.#....#.................
.............#..........#....#................#.......#..........................................#.....#..........................
.............................................#................................#.........................#...#.....................
.........#........#...................................................................#.......#....#..............................
....................................#.......................#..............#...............................#......................
....#....................#................................#....#...........#.............#........................................
....#...........#...................#.#..................................................#.....................#..................
..........#....................#............#.##...#.......#....#...............#.....#...#.........................#.............
.......#....................................................................................................#.................#...
...............................................................................#......#.................#...#.....................
..................#........#..........#..........................................................................#................
..........................................................................................#.......................................
.#..#...........#.................................##...........................#.....#...................#..#.....................
........................#..#..........................................................#............#..................#..........#
...........#...................................................##...........................#...............................#.....
........#......................................................................................................#..................
........#..#............................#..#...........#..............................#......................#.##...........#....#
........#...#.#..............#...#.....................#....................#.#..............................#....................
.......................................................#....................................................#..#..................
...........................................#......................#................#........................#....................#
.............#...............#................................................................................#...................
..#...#............#.............#.....#........................#............#....................#...............................
.....#...................................................................................................................#........
....................#..#...........#....#.............................................................................#.......#...
..............#......#.........................#...........#...#...........................................#...#..................
..............................#.....#.........................................................#......#.#......#...................
............................................................#...................#.#............................#..................
.............###.#........................................#........................................................#..............
......#................................#...............##.........................................................................
.........#.....#.#.....................#.......................................#...............#..........#....#....#.............
..............................................#....................................#...........................................#..
............#.#..........#........#..#.....#.............#..........#............#......#...................##..........#.........
............#....#...................................#.............................#.........................#....................
.#..................................#....#.........................................................................#..............
.........................#...#...#.................#..................#.............#.#...#...............#.......................
.........#...............................#...........#.............................#...........................#..........#.......
......#..........................#.............#..........#.......................................................................
.......#...............#.........#.............#...............................#..................................................
..#......#....................##...........................................#........................................#.............
..........................#.....#.......................#...........................................................#.#...........
..#....................#.............#................................................................#.#.........................
.........#....................#.....#....#...............#.......................#........#.......................................
..............#...................................................................#................#...#..........................
....................#.....#.......#..#......................................#...........#..................................##....#
.......#.......................................................................#..................................................
......#.............##..........................#..#......................^.......................................................
..............................#..........#...................#.................................#.....................#............
.......................##..........................#.......#..............................#...................................#.#.
................#....................................................................#...............................#.........#..
..........................................#......#.....................................#................#........#................
#......................................#.......................................................#..#...........#...................
.......#.............#..................#..#...#............#.......#.....#.....#.#...............................................
.............................#........#.............#.....#.......#...................................#.#..................#......
.................#......................................................................................#........#..#.............
........................................................................#..............#.....#..............................#.....
....#....#..........................................#......##...#....................#...................#..........#.............
.................##.......................##.#.........#................................................#.........................
.#..............................................#.........................#.#.#..........#.....................................##.
............................................................#..........#....#...................................................#.
....#...........#.............................#.....................#.........#..................#...........................#....
......#.#.......#..#......#........#..#...................#....#..................................................................
............#........................................................................................................#............
.....................................................#..........................................#................#................
...#.......#..#..............#.............................#....................................#.................................
.................##.........#........................#....................................#...............#.#.#...................
................#......#......................#..#..........................................#.....................................
......#..................................................##.#.#........#...........................#.......................#......
........................#............#......#.........#.............#.............................................#.....#.##......
......................#........................................#.......#.........#.................#..#...........#...............
..#.......#.........##..#.#................................................................................#.........#............
........................................................................................#............#...........#................
................#...#....................#..##..#...............#.............................................................#...
...#........#..........................#.....#..........................#....................................#.........#.......##.
.................#...........................#.........#......#............................#.....................#................
...................#..........#....#.......#...................#.............................#..........#.........................
.......#..............#.................................#.........#....................................#.................#....##.#
..................................#.......................#....#..#.........................#....................#................
.....#.........#............#...#.........#........#...................#...#......................#.....#............#............
#.#....#...#........#................................##..........................#.............................##...#....#........
.............##..........##...#......#.......#.#................#.#.......................#.............#.........................
.............#....................................#....................................#..........................................
..................................#..............................#.......................................#................#.......
...................#...............#..............................................................................................
....#........#.................................#........#.....................................#.......#................#........#.
.................#......#.......................................................##.....#..................#.......................
...............#.......................#.#........#...........................................#........#.........................."""

def find_pos(lines):
    for rowIdx,line in enumerate(lines):
        for colIdx, el in enumerate(line):
            if el == ">":
                return [(rowIdx, colIdx), "right"]
            if el == "<":
                return [(rowIdx, colIdx), "left"]
            if el == "v":
                return [(rowIdx, colIdx), "down"]
            if el == "^":
                return [(rowIdx, colIdx), "up"]
    assert True, "NO POS FOUND IN LINES"


inp = inp_real

lines = [el for el in inp.split("\n")]

get_right_coords = lambda x: (x[0],x[1]+1)
get_left_coords = lambda x: (x[0],x[1]-1)
get_top_coords = lambda x: (x[0]-1,x[1])
get_botoom_coords = lambda x: (x[0]+1,x[1])

def get_next_coords(coords, direction):
    if direction == "right":
        return get_right_coords(coords)
    if direction == "left":
        return get_left_coords(coords)
    if direction == "down":
        return get_botoom_coords(coords)
    if direction == "up":
        return get_top_coords(coords)

def is_out_of_bounds(coords):
    return coords[0] < 0 or coords[0] > len(lines) - 1 or coords[1] < 0 or coords[1] > len(lines[0]) - 1 

def print_lines_and_visited_coords(lines,visited_coords):
    lines_visited = [list(line) for line in lines]
    for vis in visited_coords:
        lines_visited[vis[0]][vis[1]] = "X"
    print("\n".join(["".join(line) for line in lines_visited]))

def is_valid_pos(coords, lines):
    el = lines[coords[0]][coords[1]]
    return el != "#" and el != "O"

def turn_direction_right(direction):
    match direction:
        case "right":
            return "down"
        case "down":
            return "left"
        case "left":
            return "up"
        case "up":
            return "right"
def get_visited_coords_p1(lines):
    visited_coords = []

    coords, direction = find_pos(lines)
    while True:
        visited_coords.append(coords)
        next_coords = get_next_coords(coords,direction)
        if is_out_of_bounds(next_coords):
            break
        if is_valid_pos(next_coords, lines):
            coords = next_coords
            direction = direction
        else:
            coords = coords
            direction = turn_direction_right(direction)
    return list(set(visited_coords))


def is_infinite_loop(given_lines):
    visited_coords_including_direction = []

    coords, direction = find_pos(given_lines)
    while True:
        if (coords,direction) in visited_coords_including_direction:
            print(f"{coords} {direction} are visited again!")
            return True
        visited_coords_including_direction.append((coords, direction))
        next_coords = get_next_coords(coords,direction)
        if is_out_of_bounds(next_coords):
            break
        if is_valid_pos(next_coords, given_lines):
            coords = next_coords
            direction = direction
        else:
            coords = coords
            direction = turn_direction_right(direction)
    return False

def lines_new_obstacle(lines,newObstacleCoords):
    lines_els = [list(line) for line in lines]
    lines_els[newObstacleCoords[0]][newObstacleCoords[1]] = "O"
    lines_els = ["".join(line) for line in lines_els]
    return lines_els

# print("\n".join(lines))
visited_coords_p1 = get_visited_coords_p1(lines)
# print(visited_coords_p1)
# lines_visited = [list(line) for line in lines]
# for vis in visited_coords_p1:
#     lines_visited[vis[0]][vis[1]] = "X"

# print("\n".join(["".join(line) for line in lines_visited]))

start_coord, _ = find_pos(lines)
possible_obstacle_coords = list(filter(lambda x: x != start_coord, visited_coords_p1))
count = 0
for poss_coord in possible_obstacle_coords:
    new_lines_with_extra_obstacle = lines_new_obstacle(lines,poss_coord)
    # print_lines_and_visited_coords(new_lines_with_extra_obstacle,[])
    # print(f"new_lines_with_extra_obstacle")
    if is_infinite_loop(new_lines_with_extra_obstacle):
        count += 1
    # coords = is_infinite_loop(new_lines_with_extra_obstacle)
    # print_lines_and_visited_coords(new_lines_with_extra_obstacle,coords)
    

    # if is_infinite_loop(new_lines_with_extra_obstacle):
        # count += 1

print(count)






